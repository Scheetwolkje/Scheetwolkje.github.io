<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Webgame - Slotmachine</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Press Start 2P', monospace;
      /* Background image */
      background: #000 url('pics/casino.jpg') no-repeat center center;
      background-size: cover;
      color: #0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      min-height: 100vh;
      position: relative;
      overflow: hidden;
    }
    .home-link {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 3;
    }
    .home-link img {
      width: 150px;
      height: 150px;
      cursor: pointer;
    }
    #mute-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: red;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      cursor: pointer;
      z-index: 3;
    }
    h1 {
      margin-top: 4rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 0 #000;
    }
    #slot-machine {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(0,0,0,0.5);
      padding: 2rem;
      border: 2px solid #0f0;
      z-index: 2;
      overflow: hidden;
    }
    .reels { display: flex; gap: 1rem; margin-bottom: 1rem; }
    .reel {
      width: 60px;
      height: 60px;
      background: #111;
      border: 2px solid #0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2rem;
    }
    button.spin {
      background: #0f0;
      color: #000;
      border: none;
      padding: 0.5rem 1rem;
      cursor: pointer;
      transition: transform .2s;
    }
    button.spin:hover { transform: scale(1.1); }
    #win-video {
      display: none;
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      z-index: 5;
    }
  </style>
</head>
<body class="admin">
  <a href="index.html" class="home-link"><img src="pics/heisenberg.png" alt="Home"></a>
  <audio id="bgm" src="audio/waluigi.mp3" loop autoplay></audio>
  <button id="mute-btn">Mute</button>

  <h1>Slotmachine</h1>
  <div id="slot-machine">
    <video id="win-video" src="videos/gamblecore.mp4"></video>
    <div class="reels">
      <div class="reel" id="reel1">üçí</div>
      <div class="reel" id="reel2">üçã</div>
      <div class="reel" id="reel3">üîî</div>
    </div>
    <button class="spin" id="spin-btn">Spin</button>
    <div id="slot-result" style="margin-top:1rem;"></div>
    <div id="balance" style="margin-top:1rem;">Balance: $0</div>
  </div>

  <audio id="win-sfx" src="audio/cash.mp3"></audio>
  <audio id="loss-sfx" src="audio/cash.mp3"></audio>

  <script>
    const bgm = document.getElementById('bgm');
    const muteBtn = document.getElementById('mute-btn');
    muteBtn.addEventListener('click', () => {
      bgm.muted = !bgm.muted;
      muteBtn.textContent = bgm.muted ? 'Unmute' : 'Mute';
    });

    const symbols = ['üçí','üçã','üîî','üçá','‚≠ê'];
    const reels = ['reel1','reel2','reel3'].map(id=>document.getElementById(id));
    const resultDiv = document.getElementById('slot-result');
    const balanceEl = document.getElementById('balance');
    const winSfx = document.getElementById('win-sfx');
    const lossSfx = document.getElementById('loss-sfx');
    const winVideo = document.getElementById('win-video');
    // Set sfx to max volume
    winSfx.volume = 1;
    lossSfx.volume = 1;
    let balance = 0;

    function spawnGif(src) {
      const img = document.createElement('img');
      img.src = src;
      img.style.position = 'absolute';
      const size = 100;
      img.style.width = size + 'px'; img.style.height = 'auto';
      img.style.left = Math.random()*(window.innerWidth-size) + 'px';
      img.style.top  = Math.random()*(window.innerHeight-size) + 'px';
      img.style.pointerEvents = 'none'; img.style.zIndex = 4;
      document.body.appendChild(img);
      setTimeout(() => img.remove(), 1500);
    }

    document.getElementById('spin-btn').addEventListener('click', () => {
      const outcomes = reels.map(el => {
        const sym = symbols[Math.floor(Math.random()*symbols.length)];
        el.textContent = sym; return sym;
      });
      const win = outcomes.every(s => s === outcomes[0]);
      if(win) {
        balance += 100000;
        resultDiv.textContent = 'Jackpot! +$10000';
        winSfx.currentTime = 0; winSfx.play(); spawnGif('gifs/win.gif');
        winVideo.style.display = 'block'; winVideo.currentTime = 0; winVideo.play();
      } else {
        balance -= 1;
        resultDiv.textContent = 'Try again! -$1';
        lossSfx.currentTime = 0; lossSfx.play(); spawnGif('gifs/gambling.gif');
      }
      balanceEl.textContent = 'Balance: $' + balance;
    });

    winVideo.addEventListener('ended', () => { winVideo.style.display = 'none'; });
    document.addEventListener('keydown', e => { if(e.key==='A') document.body.classList.toggle('admin'); });

    // Cursor trail
    const canvas = document.getElementById('trail'), ctx = canvas.getContext('2d');
    function resize(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
    window.addEventListener('resize',resize); resize();
    let prevX=null, prevY=null;
    document.addEventListener('mousemove', e=>{
      if(prevX===null){ prevX=e.clientX; prevY=e.clientY; return; }
      ctx.beginPath(); ctx.moveTo(prevX, prevY); ctx.lineTo(e.clientX, e.clientY);
      ctx.strokeStyle='rgba(0,255,0,0.7)'; ctx.lineWidth=2; ctx.stroke(); ctx.closePath();
      prevX=e.clientX; prevY=e.clientY;
    });
    document.addEventListener('mousedown',()=>{ prevX=null; prevY=null; });

    // Explosion effect
    document.addEventListener('click', e=>{
      const explosion=document.createElement('img');
      explosion.src='gifs/explosion2.gif'; explosion.style.position='absolute';
      explosion.style.left=(e.clientX-32)+'px'; explosion.style.top=(e.clientY-32)+'px';
      explosion.style.width='64px'; explosion.style.height='64px'; explosion.style.pointerEvents='none'; explosion.style.zIndex=5;
      document.body.appendChild(explosion);
      setTimeout(()=>explosion.remove(),1000);
    });
  </script>
</body>
</html>
